service: granola-scraper

provider:
  name: aws
  runtime: nodejs8.10
  memorySize: 1536
  # iamRoleStatements:

functions:
  granolaScraper:
    handler: src/lambda-script.handler
    description: single page application scraper
    timeout: 300

# for test only...productData table name can change
resources:
  Resources:
    productInfoTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: productInfo
        AttributeDefinitions:
          - AttributeName: url
            AttributeType: S
        KeySchema:
          - AttributeName: url
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
    productDataTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: 2018-W1_2018-W52
        AttributeDefinitions:
          - AttributeName: date
            AttributeType: S
          - AttributeName: url
            AttributeType: S
        KeySchema:
          - AttributeName: date
            KeyType: HASH
          - AttributeName: url
            KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 4
          WriteCapacityUnits: 4

plugins:
  - serverless-plugin-typescript
  - serverless-dynamodb-local
  - serverless-offline

package:
  exclude:
    - node_modules/@serverless-chrome/**
    - node_modules/puppeteer/.local-chromium/**
  include:
    - chrome/**

custom:
  chrome:
    flags:
      - --window-size=400,400
      - --hide-scrollbars
    functions:
      - granolaScraper